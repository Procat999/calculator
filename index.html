<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>System Emulator Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        
        body, html {
            margin: 0; padding: 0; height: 100%; background: #000; color: white;
            overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            user-select: none; -webkit-tap-highlight-color: transparent;
        }

        /* --- ENTRY LAYER --- */
        #entry-layer {
            position: fixed; inset: 0; background: #000; z-index: 1000;
            display: flex; flex-direction: column; padding: 20px;
            justify-content: flex-end; align-items: center; 
            transition: transform 0.8s cubic-bezier(0.85, 0, 0.15, 1);
        }

        .calc-container { width: 100%; max-width: 380px; display: flex; flex-direction: column; justify-content: flex-end; height: 100%; padding-bottom: 20px; }

        .iphone-btn { aspect-ratio: 1; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; cursor: pointer; transition: background 0.1s; }
        .iphone-btn:active { opacity: 0.7; }
        .iphone-btn.gray { background: #a5a5a5; color: black; }
        .iphone-btn.dark { background: #333333; color: white; }
        .iphone-btn.orange { background: #ff9f0a; color: white; }

        /* --- WINDOWS EMULATOR --- */
        #win-emulator {
            display: none; width: 100vw; height: 100vh;
            background: url('https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?auto=format&fit=crop&w=2000') center/cover;
            position: relative;
        }

        .win-taskbar {
            position: absolute; bottom: 0; width: 100%; height: 48px;
            background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(20px);
            display: flex; align-items: center; justify-content: center; z-index: 100;
        }

        /* --- APP WINDOWS --- */
        .app-window {
            position: absolute; top: 10%; left: 10%; width: 80%; height: 75%;
            background: #1a1a1a; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); display: none;
            flex-direction: column; overflow: hidden; z-index: 50;
        }

        .window-header { padding: 12px; background: rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center; cursor: move; }

        /* --- SEARCH MENU --- */
        #search-menu {
            position: absolute; bottom: 54px; left: 50%; transform: translateX(-50%);
            width: 500px; max-width: 95vw; background: rgba(243, 244, 246, 0.95);
            backdrop-filter: blur(20px); border-radius: 12px; display: none;
            flex-direction: column; padding: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); z-index: 200;
        }

        /* --- MOBILE EMULATOR --- */
        #android-emulator { display: none; width: 100vw; height: 100vh; background: linear-gradient(180deg, #0f172a 0%, #020617 100%); flex-direction: column; }

        /* --- SHARED --- */
        .hidden { display: none !important; }
        .fade-out { transform: translateY(-100%) scale(0.9); opacity: 0; }

        /* --- DRAGGABLE ICONS --- */
        #desktop-icons { position: absolute; inset: 0; padding: 20px; pointer-events: none; }
        .desktop-icon {
            width: 80px; position: absolute; display: flex; flex-direction: column;
            align-items: center; gap: 4px; cursor: pointer; text-align: center; pointer-events: auto;
            transition: transform 0.1s;
        }
        .desktop-icon:active { transform: scale(0.95); }
        .desktop-icon .icon-box {
            width: 48px; height: 48px; border-radius: 10px; display: flex;
            align-items: center; justify-content: center; box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            pointer-events: none; /* Let the container handle clicks */
        }

        .context-menu {
            position: fixed; background: #222; border: 1px solid #444; border-radius: 8px;
            padding: 4px; z-index: 1000; display: none; min-width: 120px;
        }
        .context-menu button {
            width: 100%; text-align: left; padding: 8px 12px; font-size: 12px; border-radius: 4px; color: white;
        }
        .context-menu button:hover { background: #333; color: #ff4444; }

        #game-container canvas { background: #000; border: 2px solid #333; max-width: 90vw; max-height: 50vh; }
    </style>
</head>
<body>

    <!-- CALCULATOR LOCK -->
    <div id="entry-layer">
        <div class="calc-container">
            <div class="mb-6 px-4"><div id="entry-display" class="text-right text-white text-7xl font-light truncate">0</div></div>
            <div class="grid grid-cols-4 gap-3">
                <div onclick="press('AC')" class="iphone-btn gray">AC</div>
                <div onclick="press('+/-')" class="iphone-btn gray">‚Å∫/‚Çã</div>
                <div onclick="press('%')" class="iphone-btn gray">%</div>
                <div onclick="press('/')" class="iphone-btn orange">√∑</div>
                <div onclick="press('7')" class="iphone-btn dark">7</div>
                <div onclick="press('8')" class="iphone-btn dark">8</div>
                <div onclick="press('9')" class="iphone-btn dark">9</div>
                <div onclick="press('*')" class="iphone-btn orange">√ó</div>
                <div onclick="press('4')" class="iphone-btn dark">4</div>
                <div onclick="press('5')" class="iphone-btn dark">5</div>
                <div onclick="press('6')" class="iphone-btn dark">6</div>
                <div onclick="press('-')" class="iphone-btn orange">‚àí</div>
                <div onclick="press('1')" class="iphone-btn dark">1</div>
                <div onclick="press('2')" class="iphone-btn dark">2</div>
                <div onclick="press('3')" class="iphone-btn dark">3</div>
                <div onclick="press('+')" class="iphone-btn orange">+</div>
                <div onclick="press('0')" class="iphone-btn dark col-span-2 !aspect-auto !rounded-full !justify-start pl-8">0</div>
                <div onclick="press('.')" class="iphone-btn dark">.</div>
                <div onclick="press('=')" class="iphone-btn orange">=</div>
            </div>
        </div>
    </div>

    <!-- CONTEXT MENU -->
    <div id="icon-ctx" class="context-menu">
        <button id="ctx-delete" class="flex items-center gap-2"><i data-lucide="trash-2" class="w-3 h-3"></i> Uninstall</button>
    </div>

    <!-- WINDOWS 11 DESKTOP -->
    <div id="win-emulator" oncontextmenu="return false;">
        <div id="desktop-icons">
            <div class="desktop-icon" style="top:20px; left:20px" data-id="store" onmousedown="handleIconInteraction(event, 'store')">
                <div class="icon-box bg-blue-600"><i data-lucide="shopping-bag" class="text-white"></i></div>
                <span class="text-[10px] text-white">App Store</span>
            </div>
            <div class="desktop-icon" style="top:20px; left:110px" data-id="notes" onmousedown="handleIconInteraction(event, 'notes')">
                <div class="icon-box bg-yellow-500"><i data-lucide="file-text" class="text-white"></i></div>
                <span class="text-[10px] text-white">System Notes</span>
            </div>
        </div>

        <!-- SEARCH MENU -->
        <div id="search-menu">
            <div class="flex items-center bg-white rounded-lg p-2 mb-4 border border-gray-200">
                <i data-lucide="search" class="text-gray-400 w-4 h-4 mr-2"></i>
                <input type="text" id="search-input" placeholder="Search apps and games..." class="bg-transparent outline-none text-sm text-black w-full" oninput="filterSearch()">
            </div>
            <div id="search-results" class="space-y-1 overflow-y-auto max-h-[300px]"></div>
        </div>

        <!-- APP WINDOW: STORE -->
        <div id="win-store" class="app-window">
            <div class="window-header">
                <div class="flex items-center gap-2 text-xs font-bold"><i data-lucide="shopping-bag" class="w-3 h-3"></i> SYSTEM_STORE</div>
                <button onclick="closeApp('store')" class="hover:text-red-500"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            <div class="flex-grow p-6 overflow-y-auto">
                <h2 class="text-xl font-bold mb-4">Marketplace</h2>
                <div id="store-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>
        </div>

        <!-- APP WINDOW: NOTES -->
        <div id="win-notes" class="app-window">
            <div class="window-header">
                <div class="flex items-center gap-2 text-xs font-bold"><i data-lucide="file-text" class="w-3 h-3"></i> NOTES.TXT</div>
                <button onclick="closeApp('notes')" class="hover:text-red-500"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            <div class="flex-grow p-6 bg-zinc-900 font-mono text-sm overflow-y-auto">
                <div class="text-zinc-400 mb-4">System Information File</div>
                <pre class="text-green-500">
-made by procat
-version 1.2
-windows 10 (System Emulation)
-android 16 (Mobile Emulation)
-security: encrypted

[PATCH NOTES]
* Fixed app opening issue (Hold to move, Tap to open)
* Fixed toggleSettings error
* Added draggable desktop icons
* Added system search menu
* Added uninstall functionality
                </pre>
            </div>
        </div>

        <!-- APP WINDOW: GAME ENGINE -->
        <div id="win-arcade" class="app-window">
            <div class="window-header">
                <div class="flex items-center gap-2 text-xs font-bold"><i data-lucide="gamepad-2" class="w-3 h-3"></i> <span id="current-game-title">GAME</span></div>
                <button onclick="closeApp('arcade')" class="hover:text-red-500"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            <div id="game-container" class="flex-grow flex flex-col items-center justify-center bg-black">
                <div id="score-display" class="mb-2 text-green-500 font-mono">SCORE: 0</div>
                <canvas id="gameCanvas" width="400" height="400"></canvas>
            </div>
        </div>

        <div class="win-taskbar">
            <img src="https://upload.wikimedia.org/wikipedia/commons/archive/8/87/20211103131742%21Windows_logo_-_2021.svg" class="w-6 h-6 cursor-pointer" onclick="toggleSearch()">
            <div id="taskbar-apps" class="flex gap-2 ml-4"></div>
            <div class="absolute right-4 text-black text-[11px] font-semibold text-right">
                <div id="clock-time">12:00 PM</div>
                <div id="clock-date">1/21/2026</div>
            </div>
        </div>
    </div>

    <!-- ANDROID MOBILE EMULATOR -->
    <div id="android-emulator">
        <div class="p-6 pt-12 flex flex-col h-full">
            <div class="flex justify-between items-center mb-10">
                <div id="mobile-time" class="text-xl font-bold">12:00</div>
                <div class="flex gap-2"><i data-lucide="wifi" class="w-4 h-4"></i><i data-lucide="battery" class="w-4 h-4"></i></div>
            </div>
            <div class="grid grid-cols-4 gap-y-8" id="mobile-icons">
                <div class="flex flex-col items-center gap-2" onclick="openApp('store')">
                    <div class="w-16 h-16 bg-blue-600 rounded-[22px] flex items-center justify-center shadow-xl"><i data-lucide="shopping-bag" class="w-8 h-8 text-white"></i></div>
                    <span class="text-[10px] font-medium opacity-80">Store</span>
                </div>
                <div class="flex flex-col items-center gap-2" onclick="openApp('notes')">
                    <div class="w-16 h-16 bg-yellow-500 rounded-[22px] flex items-center justify-center shadow-xl"><i data-lucide="file-text" class="w-8 h-8 text-white"></i></div>
                    <span class="text-[10px] font-medium opacity-80">Notes</span>
                </div>
            </div>
            <div class="mt-auto flex justify-center pb-4"><div class="w-24 h-1.5 bg-white/30 rounded-full" onclick="panic()"></div></div>
        </div>
    </div>

    <script>
        const APPS_DB = [
            { id: 'snake', name: 'Snake Pro', color: 'bg-green-600', emoji: 'üêç', desc: 'Classic survival.' },
            { id: 'mines', name: 'Minesweeper', color: 'bg-red-600', emoji: 'üí£', desc: 'Find the bombs.' },
            { id: 'tetris', name: 'Block Fit', color: 'bg-yellow-600', emoji: 'üß±', desc: 'Stack them up.' },
            { id: 'spacer', name: 'Galaxian', color: 'bg-indigo-600', emoji: 'üöÄ', desc: 'Space defense.' }
        ];

        let installedApps = [];
        let calcVal = "0", calcPrev = null, calcOp = null, calcWait = false, lastAcTap = 0;
        let gameLoop = null, score = 0, currentDragged = null, dragOffset = {x:0, y:0};
        let mouseDownTime = 0, isDragging = false;

        // --- CALC CORE ---
        function press(key) {
            const display = document.getElementById('entry-display');
            if (key === 'AC') {
                const now = Date.now();
                if (now - lastAcTap < 300) { panic(); return; }
                lastAcTap = now;
                calcVal = "0"; calcPrev = null; calcOp = null; calcWait = false;
            } else if (!isNaN(key) || key === '.') {
                if (calcWait) { calcVal = key; calcWait = false; }
                else { calcVal = calcVal === "0" ? key : calcVal + key; }
            } else if (['+', '-', '*', '/'].includes(key)) { calcPrev = parseFloat(calcVal); calcOp = key; calcWait = true; }
            else if (key === '=') {
                const current = parseFloat(calcVal);
                if (calcPrev === 776 && calcOp === '*' && current === 228) { launchSystem(); return; }
                if (calcOp) {
                    let res = 0;
                    if (calcOp === '+') res = calcPrev + current;
                    if (calcOp === '-') res = calcPrev - current;
                    if (calcOp === '*') res = calcPrev * current;
                    if (calcOp === '/') res = calcPrev / current;
                    calcVal = String(Math.round(res * 100) / 100); calcOp = null;
                }
            }
            display.innerText = calcVal;
        }

        function launchSystem() {
            document.getElementById('entry-layer').classList.add('fade-out');
            setTimeout(() => {
                document.getElementById('entry-layer').classList.add('hidden');
                const isMobile = window.innerWidth < 768;
                if (isMobile) document.getElementById('android-emulator').style.display = 'flex';
                else document.getElementById('win-emulator').style.display = 'block';
                renderStore(); renderSearch();
            }, 600);
        }

        function openApp(id) {
            const win = document.getElementById(`win-${id}`);
            if (!win) {
                document.getElementById(`win-arcade`).style.display = 'flex';
                startGame(id);
            } else { win.style.display = 'flex'; }
            document.getElementById('search-menu').style.display = 'none';
            refreshIcons();
        }

        function closeApp(id) {
            document.getElementById(`win-${id}`).style.display = 'none';
            if (id === 'arcade') exitGame();
        }

        function panic() { location.reload(); }

        // --- IMPROVED DRAG & CLICK LOGIC ---
        function handleIconInteraction(e, id) {
            if (e.button !== 0) return; // Only left click
            
            mouseDownTime = Date.now();
            isDragging = false;
            currentDragged = e.currentTarget;
            const rect = currentDragged.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            
            const onMouseMove = (moveEv) => {
                const dist = Math.hypot(moveEv.clientX - e.clientX, moveEv.clientY - e.clientY);
                if (dist > 5) {
                    isDragging = true;
                    currentDragged.style.left = (moveEv.clientX - dragOffset.x) + 'px';
                    currentDragged.style.top = (moveEv.clientY - dragOffset.y) + 'px';
                }
            };

            const onMouseUp = () => {
                window.removeEventListener('mousemove', onMouseMove);
                window.removeEventListener('mouseup', onMouseUp);
                
                const clickDuration = Date.now() - mouseDownTime;
                // If it wasn't dragged much and it was a short click, open the app
                if (!isDragging && clickDuration < 300) {
                    openApp(id);
                }
                currentDragged = null;
            };

            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('mouseup', onMouseUp);
        }

        // --- SEARCH & STORE ---
        function toggleSearch() {
            const menu = document.getElementById('search-menu');
            menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
            if (menu.style.display === 'flex') {
                document.getElementById('search-input').focus();
                renderSearch();
            }
        }

        function renderSearch() {
            const res = document.getElementById('search-results');
            const term = document.getElementById('search-input').value.toLowerCase();
            const all = [
                {id: 'store', name: 'App Store', emoji: 'üõçÔ∏è'},
                {id: 'notes', name: 'Notes', emoji: 'üìù'},
                ...installedApps.map(id => APPS_DB.find(a => a.id === id))
            ].filter(a => a.name.toLowerCase().includes(term));

            res.innerHTML = all.map(a => `
                <div onclick="openApp('${a.id}')" class="flex items-center gap-3 p-2 hover:bg-gray-200 rounded-md cursor-pointer text-black">
                    <div class="text-xl">${a.emoji || '‚öôÔ∏è'}</div>
                    <div class="text-xs font-semibold">${a.name}</div>
                </div>
            `).join('');
        }

        function filterSearch() { renderSearch(); }

        function renderStore() {
            const list = document.getElementById('store-list');
            list.innerHTML = APPS_DB.map(app => `
                <div class="bg-zinc-800/50 p-4 rounded-xl flex items-center gap-4 border border-white/5">
                    <div class="w-12 h-12 ${app.color} rounded-lg flex items-center justify-center text-xl shadow-lg">${app.emoji}</div>
                    <div class="flex-grow">
                        <h4 class="font-bold text-sm">${app.name}</h4>
                        <div id="install-bar-${app.id}" class="h-1 bg-zinc-700 mt-2 hidden"><div class="h-full bg-blue-500 transition-all duration-300" style="width:0%"></div></div>
                    </div>
                    <button id="install-btn-${app.id}" onclick="installApp('${app.id}')" class="px-3 py-1 bg-white text-black text-[10px] font-bold rounded-full">
                        ${installedApps.includes(app.id) ? 'GET' : 'INSTALL'}
                    </button>
                </div>
            `).join('');
        }

        function installApp(id) {
            if (installedApps.includes(id)) return;
            const bar = document.getElementById(`install-bar-${id}`);
            const btn = document.getElementById(`install-btn-${id}`);
            btn.classList.add('hidden'); bar.classList.remove('hidden');
            let p = 0;
            const iv = setInterval(() => {
                p += 10; bar.children[0].style.width = p + '%';
                if (p >= 100) {
                    clearInterval(iv); installedApps.push(id);
                    renderInstalledApps(); renderStore();
                }
            }, 100);
        }

        function renderInstalledApps() {
            const desktop = document.getElementById('desktop-icons');
            const mobile = document.getElementById('mobile-icons');
            document.querySelectorAll('.dynamic-app').forEach(el => el.remove());

            installedApps.forEach((id, idx) => {
                const app = APPS_DB.find(a => a.id === id);
                // Desktop
                const d = document.createElement('div');
                d.className = 'desktop-icon dynamic-app';
                d.style.top = (20 + (idx + 2) * 90) + 'px'; d.style.left = '20px';
                d.dataset.id = id;
                d.onmousedown = (e) => handleIconInteraction(e, id);
                d.oncontextmenu = (e) => showContext(e, id);
                d.innerHTML = `<div class="icon-box ${app.color}">${app.emoji}</div><span class="text-[10px] text-white">${app.name}</span>`;
                desktop.appendChild(d);

                // Mobile
                const m = document.createElement('div');
                m.className = 'flex flex-col items-center gap-2 dynamic-app';
                m.onclick = () => openApp(id);
                m.innerHTML = `<div class="w-16 h-16 ${app.color} rounded-[22px] flex items-center justify-center text-3xl">${app.emoji}</div><span class="text-[10px] font-medium opacity-80">${app.name}</span>`;
                mobile.appendChild(m);
            });
            refreshIcons();
        }

        function showContext(e, id) {
            e.preventDefault();
            const menu = document.getElementById('icon-ctx');
            menu.style.display = 'block';
            menu.style.left = e.clientX + 'px';
            menu.style.top = e.clientY + 'px';
            document.getElementById('ctx-delete').onclick = () => {
                installedApps = installedApps.filter(a => a !== id);
                renderInstalledApps(); renderStore(); menu.style.display = 'none';
            };
            return false;
        }

        document.addEventListener('click', () => document.getElementById('icon-ctx').style.display = 'none');

        // --- MINI GAMES ENGINE ---
        function startGame(type) {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreEl = document.getElementById('score-display');
            document.getElementById('current-game-title').innerText = type.toUpperCase() + ".EXE";
            score = 0; scoreEl.innerText = "SCORE: 0";
            if (gameLoop) clearInterval(gameLoop);

            if (type === 'snake') {
                let snake = [{x:10, y:10}], food = {x:15, y:15}, dir = {x:1,y:0}, nextDir = {x:1,y:0};
                window.gameInput = (d) => {
                    if (d === 'up' && dir.y === 0) nextDir = {x: 0, y: -1};
                    if (d === 'down' && dir.y === 0) nextDir = {x: 0, y: 1};
                    if (d === 'left' && dir.x === 0) nextDir = {x: -1, y: 0};
                    if (d === 'right' && dir.x === 0) nextDir = {x: 1, y: 0};
                };
                gameLoop = setInterval(() => {
                    dir = nextDir;
                    const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
                    if (head.x < 0) head.x = 19; if (head.x > 19) head.x = 0;
                    if (head.y < 0) head.y = 19; if (head.y > 19) head.y = 0;
                    if (head.x === food.x && head.y === food.y) {
                        food = {x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20)};
                        score += 10; scoreEl.innerText = "SCORE: " + score;
                    } else snake.pop();
                    if (snake.some(s => s.x === head.x && s.y === head.y)) exitGame();
                    snake.unshift(head);
                    ctx.fillStyle = '#000'; ctx.fillRect(0,0,400,400);
                    ctx.fillStyle = '#0f0'; snake.forEach(p => ctx.fillRect(p.x*20, p.y*20, 18, 18));
                    ctx.fillStyle = '#f00'; ctx.fillRect(food.x*20, food.y*20, 18, 18);
                }, 100);
            } else {
                ctx.fillStyle = '#000'; ctx.fillRect(0,0,400,400);
                ctx.fillStyle = '#fff'; ctx.font = '12px monospace';
                ctx.fillText(type.toUpperCase() + " LOADED. READY TO PLAY.", 80, 200);
            }
        }

        function exitGame() { clearInterval(gameLoop); document.getElementById('win-arcade').style.display = 'none'; }
        function refreshIcons() { if (window.lucide) window.lucide.createIcons(); }
        
        function updateClocks() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            if (document.getElementById('clock-time')) document.getElementById('clock-time').innerText = timeStr;
            if (document.getElementById('mobile-time')) document.getElementById('mobile-time').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
            setTimeout(updateClocks, 1000);
        }

        window.onload = () => { updateClocks(); refreshIcons(); };
    </script>
</body>
</html>
