<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>System Emulator Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        
        body, html {
            margin: 0; padding: 0; height: 100%; background: #000; color: white;
            overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            user-select: none; -webkit-tap-highlight-color: transparent;
        }

        /* --- ENTRY LAYER --- */
        #entry-layer {
            position: fixed; inset: 0; background: #000; z-index: 1000;
            display: flex; flex-direction: column; padding: 20px;
            justify-content: flex-end; align-items: center; 
            transition: transform 0.8s cubic-bezier(0.85, 0, 0.15, 1);
        }

        .calc-container { width: 100%; max-width: 380px; display: flex; flex-direction: column; justify-content: flex-end; height: 100%; padding-bottom: 20px; }

        .iphone-btn { aspect-ratio: 1; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; cursor: pointer; transition: background 0.1s; }
        .iphone-btn:active { opacity: 0.7; }
        .iphone-btn.gray { background: #a5a5a5; color: black; }
        .iphone-btn.dark { background: #333333; color: white; }
        .iphone-btn.orange { background: #ff9f0a; color: white; }

        /* --- WINDOWS EMULATOR --- */
        #win-emulator {
            display: none; width: 100vw; height: 100vh;
            background: url('https://images.unsplash.com/photo-1477346611705-65d1883cee1e?auto=format&fit=crop&w=2000') center/cover;
            position: relative;
        }

        .win-taskbar {
            position: absolute; bottom: 0; width: 100%; height: 48px;
            background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(20px);
            display: flex; align-items: center; justify-content: center; z-index: 200;
        }

        .app-window {
            position: absolute; top: 10%; left: 15%; width: 70%; height: 75%;
            background: #0f172a; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); display: none;
            flex-direction: column; overflow: hidden; z-index: 50;
        }
        .active-win { z-index: 100; border-color: rgba(59, 130, 246, 0.5); }

        .window-header { padding: 10px 16px; background: rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center; }

        .desktop-icon {
            width: 80px; height: 90px; position: absolute; display: flex; flex-direction: column;
            align-items: center; gap: 4px; cursor: pointer; text-align: center;
        }
        .icon-box {
            width: 50px; height: 50px; border-radius: 12px; display: flex;
            align-items: center; justify-content: center; font-size: 24px;
        }

        canvas { background: #000; display: block; image-rendering: pixelated; touch-action: none; }
        
        .game-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 16px; padding: 20px; }
        .game-card { background: #1e293b; padding: 16px; border-radius: 12px; cursor: pointer; text-align: center; transition: transform 0.2s; border: 1px solid #334155; }
        .game-card:hover { transform: translateY(-5px); border-color: #3b82f6; }

        #android-emulator { display: none; width: 100vw; height: 100vh; background: #000; }
    </style>
</head>
<body onkeydown="handleKey(event)">

    <!-- CALCULATOR -->
    <div id="entry-layer">
        <div class="calc-container">
            <div id="entry-display" class="text-right text-white text-7xl font-light mb-6 px-4 truncate">0</div>
            <div class="grid grid-cols-4 gap-3">
                <div onclick="press('AC')" class="iphone-btn gray">AC</div>
                <div onclick="press('+/-')" class="iphone-btn gray">‚Å∫/‚Çã</div>
                <div onclick="press('%')" class="iphone-btn gray">%</div>
                <div onclick="press('/')" class="iphone-btn orange">√∑</div>
                <div onclick="press('7')" class="iphone-btn dark">7</div>
                <div onclick="press('8')" class="iphone-btn dark">8</div>
                <div onclick="press('9')" class="iphone-btn dark">9</div>
                <div onclick="press('*')" class="iphone-btn orange">√ó</div>
                <div onclick="press('4')" class="iphone-btn dark">4</div>
                <div onclick="press('5')" class="iphone-btn dark">5</div>
                <div onclick="press('6')" class="iphone-btn dark">6</div>
                <div onclick="press('-')" class="iphone-btn orange">‚àí</div>
                <div onclick="press('1')" class="iphone-btn dark">1</div>
                <div onclick="press('2')" class="iphone-btn dark">2</div>
                <div onclick="press('3')" class="iphone-btn dark">3</div>
                <div onclick="press('+')" class="iphone-btn orange">+</div>
                <div onclick="press('0')" class="iphone-btn dark col-span-2 !aspect-auto !rounded-full !justify-start pl-8">0</div>
                <div onclick="press('.')" class="iphone-btn dark">.</div>
                <div onclick="press('=')" class="iphone-btn orange">=</div>
            </div>
        </div>
    </div>

    <!-- WINDOWS EMULATOR -->
    <div id="win-emulator">
        <!-- Desktop Icons -->
        <div class="desktop-icon" style="top:30px; left:30px" onclick="openApp('games')">
            <div class="icon-box bg-indigo-600">üéÆ</div>
            <span class="text-[11px] font-medium shadow-sm">Game Hub</span>
        </div>
        <div class="desktop-icon" style="top:130px; left:30px" onclick="openApp('notes')">
            <div class="icon-box bg-amber-500">üìù</div>
            <span class="text-[11px] font-medium">Readme</span>
        </div>

        <!-- APP: GAME HUB -->
        <div id="win-games" class="app-window" onmousedown="focusWin('games')">
            <div class="window-header">
                <span class="text-xs font-bold">GAME CONSOLE</span>
                <button onclick="closeApp('games')" class="hover:text-red-500"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            <div class="game-grid overflow-y-auto">
                <div class="game-card" onclick="startGame('snake')">üêç Snake</div>
                <div class="game-card" onclick="startGame('mines')">üí£ Mines</div>
                <div class="game-card" onclick="startGame('tetris')">üß± Tetris</div>
                <div class="game-card" onclick="startGame('pong')">üèì Pong</div>
                <div class="game-card" onclick="startGame('breakout')">üß± Breakout</div>
                <div class="game-card" onclick="startGame('flappy')">üê¶ Flappy</div>
                <div class="game-card" onclick="startGame('spacer')">üöÄ Galaxian</div>
                <div class="game-card" onclick="startGame('runner')">ü¶ñ Runner</div>
                <div class="game-card" onclick="startGame('maze')">üåÄ Maze</div>
            </div>
        </div>

        <!-- APP: ARCADE (The actual game instance) -->
        <div id="win-arcade" class="app-window" onmousedown="focusWin('arcade')">
            <div class="window-header">
                <span id="arcade-title" class="text-xs font-bold">PLAYING...</span>
                <div class="flex gap-4">
                    <span id="arcade-score" class="text-xs font-mono text-green-400">SCORE: 0</span>
                    <button onclick="closeApp('arcade')" class="hover:text-red-500"><i data-lucide="x" class="w-4 h-4"></i></button>
                </div>
            </div>
            <div class="flex-grow flex items-center justify-center bg-black relative">
                <canvas id="gameCanvas" width="400" height="400" oncontextmenu="return false;"></canvas>
                <div id="game-overlay" class="absolute inset-0 bg-black/80 flex flex-col items-center justify-center hidden">
                    <h2 class="text-3xl font-bold mb-4">CRITICAL FAILURE</h2>
                    <button onclick="restartGame()" class="px-8 py-2 bg-blue-600 rounded-full font-bold hover:bg-blue-500">RETRY</button>
                </div>
            </div>
        </div>

        <!-- APP: NOTES -->
        <div id="win-notes" class="app-window" onmousedown="focusWin('notes')">
            <div class="window-header">
                <span class="text-xs font-bold">README.TXT</span>
                <button onclick="closeApp('notes')" class="hover:text-red-500"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            <div class="p-6 font-mono text-sm overflow-y-auto">
                <p class="text-blue-400 mb-4">SYSTEM UPDATE 2.1</p>
                <p>- Snake: Wall collisions are now FATAL.</p>
                <p>- Minesweeper: Right-click to FLAG (üö©).</p>
                <p>- Added 5 New Games: Pong, Breakout, Flappy, Runner, Maze.</p>
                <p>- Global Shortcut: Press 'ESC' to panic exit.</p>
            </div>
        </div>

        <div class="win-taskbar">
            <div class="flex gap-4 items-center">
                <div class="w-8 h-8 flex items-center justify-center rounded hover:bg-white/10 cursor-pointer" onclick="panic()">
                    <i data-lucide="layout-grid" class="w-5 h-5 text-blue-400"></i>
                </div>
            </div>
        </div>
    </div>

    <script>
        let calcVal = "0", calcPrev = null, calcOp = null, calcWait = false;
        let lastAc = 0, currentAppId = null, gameLoop = null, score = 0;
        let activeGame = null;

        function press(key) {
            const d = document.getElementById('entry-display');
            if (key === 'AC') {
                if (Date.now() - lastAc < 300) panic();
                lastAc = Date.now();
                calcVal = "0"; calcPrev = null; calcOp = null;
            } else if (!isNaN(key)) {
                calcVal = calcVal === "0" ? key : calcVal + key;
            } else if (['+','-','*','/'].includes(key)) {
                calcPrev = parseFloat(calcVal); calcOp = key; calcVal = "0";
            } else if (key === '=') {
                const cur = parseFloat(calcVal);
                if (calcPrev === 776 && calcOp === '*' && cur === 228) { launch(); return; }
                if (calcOp === '+') calcVal = (calcPrev + cur).toString();
                if (calcOp === '-') calcVal = (calcPrev - cur).toString();
                if (calcOp === '*') calcVal = (calcPrev * cur).toString();
                if (calcOp === '/') calcVal = (calcPrev / cur).toString();
                calcOp = null;
            }
            d.innerText = calcVal;
        }

        function launch() {
            document.getElementById('entry-layer').style.transform = 'translateY(-100%)';
            setTimeout(() => {
                document.getElementById('entry-layer').style.display = 'none';
                document.getElementById('win-emulator').style.display = 'block';
                lucide.createIcons();
            }, 800);
        }

        function openApp(id) {
            const win = document.getElementById(`win-${id}`);
            win.style.display = 'flex';
            focusWin(id);
        }

        function closeApp(id) {
            document.getElementById(`win-${id}`).style.display = 'none';
            if (id === 'arcade') stopGame();
        }

        function focusWin(id) {
            document.querySelectorAll('.app-window').forEach(w => w.classList.remove('active-win'));
            document.getElementById(`win-${id}`).classList.add('active-win');
        }

        function panic() { location.reload(); }

        // --- GAME ENGINE ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameInput = {};

        function handleKey(e) {
            if (e.key === 'Escape') panic();
            gameInput[e.key] = true;
        }
        window.onkeyup = (e) => gameInput[e.key] = false;

        function startGame(type) {
            activeGame = type;
            openApp('arcade');
            document.getElementById('arcade-title').innerText = type.toUpperCase();
            document.getElementById('game-overlay').classList.add('hidden');
            score = 0;
            updateScore();
            if (gameLoop) clearInterval(gameLoop);
            
            const games = {
                snake: initSnake,
                mines: initMines,
                tetris: initTetris,
                pong: initPong,
                breakout: initBreakout,
                flappy: initFlappy,
                spacer: initSpacer,
                runner: initRunner,
                maze: initMaze
            };
            games[type]();
        }

        function restartGame() { startGame(activeGame); }
        function stopGame() { if (gameLoop) clearInterval(gameLoop); ctx.clearRect(0,0,400,400); }
        function updateScore() { document.getElementById('arcade-score').innerText = `SCORE: ${score}`; }
        function gameOver() { clearInterval(gameLoop); document.getElementById('game-overlay').classList.remove('hidden'); }

        // 1. SNAKE (WALLS ARE FATAL)
        function initSnake() {
            let snake = [{x:10, y:10}], dir = {x:1, y:0}, food = {x:5, y:5};
            gameLoop = setInterval(() => {
                if (gameInput['ArrowUp'] && dir.y === 0) dir = {x:0, y:-1};
                if (gameInput['ArrowDown'] && dir.y === 0) dir = {x:0, y:1};
                if (gameInput['ArrowLeft'] && dir.x === 0) dir = {x:-1, y:0};
                if (gameInput['ArrowRight'] && dir.x === 0) dir = {x:1, y:0};

                const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
                
                // WALL CHECK (FATAL)
                if (head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20 || snake.some(s => s.x === head.x && s.y === head.y)) {
                    return gameOver();
                }

                snake.unshift(head);
                if (head.x === food.x && head.y === food.y) {
                    score += 10; updateScore();
                    food = {x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20)};
                } else snake.pop();

                ctx.fillStyle = '#000'; ctx.fillRect(0,0,400,400);
                ctx.fillStyle = '#22c55e'; snake.forEach(p => ctx.fillRect(p.x*20, p.y*20, 18, 18));
                ctx.fillStyle = '#ef4444'; ctx.fillRect(food.x*20, food.y*20, 18, 18);
            }, 100);
        }

        // 2. MINESWEEPER (RIGHT CLICK TO FLAG)
        function initMines() {
            const size = 10, mines = 15, cell = 40;
            let grid = Array(size).fill().map(() => Array(size).fill(0).map(() => ({m:false, r:false, f:false, n:0})));
            let mCount = 0;
            while(mCount < mines) {
                let r = Math.floor(Math.random()*size), c = Math.floor(Math.random()*size);
                if(!grid[r][c].m) { grid[r][c].m = true; mCount++; }
            }
            // Calc neighbors
            for(let r=0; r<size; r++) for(let c=0; c<size; c++) {
                if(grid[r][c].m) continue;
                for(let i=-1; i<=1; i++) for(let j=-1; j<=1; j++) {
                    if(r+i>=0 && r+i<size && c+j>=0 && c+j<size && grid[r+i][c+j].m) grid[r][c].n++;
                }
            }

            const draw = () => {
                ctx.fillStyle = '#000'; ctx.fillRect(0,0,400,400);
                grid.forEach((row, r) => row.forEach((v, c) => {
                    ctx.strokeStyle = '#334155'; ctx.strokeRect(c*cell, r*cell, cell, cell);
                    if(v.f) { ctx.fillStyle = '#f59e0b'; ctx.fillText('üö©', c*cell+12, r*cell+25); }
                    else if(v.r) {
                        ctx.fillStyle = v.m ? '#ef4444' : '#1e293b';
                        ctx.fillRect(c*cell+1, r*cell+1, cell-2, cell-2);
                        if(!v.m && v.n>0) { ctx.fillStyle = '#fff'; ctx.fillText(v.n, c*cell+15, r*cell+25); }
                    } else { ctx.fillStyle = '#334155'; ctx.fillRect(c*cell+1, r*cell+1, cell-2, cell-2); }
                }));
            };
            draw();

            canvas.onmousedown = (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = Math.floor((e.clientX - rect.left)/cell), y = Math.floor((e.clientY - rect.top)/cell);
                if (e.button === 2) { // Right Click
                    grid[y][x].f = !grid[y][x].f;
                } else if(!grid[y][x].f) {
                    grid[y][x].r = true;
                    if(grid[y][x].m) return gameOver();
                    score++; updateScore();
                }
                draw();
            };
        }

        // 3. TETRIS
        function initTetris() {
            let board = Array(20).fill().map(() => Array(10).fill(0));
            let cur = [[1,1,1,1]], pos = {x:3, y:0};
            gameLoop = setInterval(() => {
                if(gameInput['ArrowLeft']) pos.x--;
                if(gameInput['ArrowRight']) pos.x++;
                pos.y++;
                if(pos.y > 18) {
                    board[pos.y][pos.x] = 1; pos = {x:3, y:0};
                    score += 5; updateScore();
                }
                ctx.fillStyle = '#000'; ctx.fillRect(0,0,400,400);
                ctx.fillStyle = '#3b82f6';
                cur.forEach((r, y) => r.forEach((v, x) => v && ctx.fillRect((pos.x+x)*20+100, (pos.y+y)*20, 18, 18)));
            }, 200);
        }

        // 4. PONG
        function initPong() {
            let p1 = 160, p2 = 160, ball = {x:200, y:200, dx:3, dy:3};
            gameLoop = setInterval(() => {
                if(gameInput['ArrowUp']) p1 -= 5; if(gameInput['ArrowDown']) p1 += 5;
                p2 += (ball.y - (p2+40)) * 0.1; // AI
                ball.x += ball.dx; ball.y += ball.dy;
                if(ball.y<0 || ball.y>390) ball.dy *= -1;
                if(ball.x<20 && ball.y>p1 && ball.y<p1+80) { ball.dx *= -1; score++; updateScore(); }
                if(ball.x>380 && ball.y>p2 && ball.y<p2+80) ball.dx *= -1;
                if(ball.x<0) return gameOver();
                
                ctx.fillStyle = '#000'; ctx.fillRect(0,0,400,400);
                ctx.fillStyle = '#fff'; 
                ctx.fillRect(10, p1, 10, 80); ctx.fillRect(380, p2, 10, 80);
                ctx.fillRect(ball.x, ball.y, 8, 8);
            }, 20);
        }

        // 5. BREAKOUT
        function initBreakout() {
            let paddle = 160, ball = {x:200, y:300, dx:2, dy:-2}, bricks = [];
            for(let i=0; i<5; i++) for(let j=0; j<8; j++) bricks.push({x:j*50+5, y:i*20+30, v:true});
            gameLoop = setInterval(() => {
                if(gameInput['ArrowLeft']) paddle -= 6; if(gameInput['ArrowRight']) paddle += 6;
                ball.x += ball.dx; ball.y += ball.dy;
                if(ball.x<0 || ball.x>390) ball.dx *= -1; if(ball.y<0) ball.dy *= -1;
                if(ball.y>370 && ball.x>paddle && ball.x<paddle+80) ball.dy *= -1;
                if(ball.y>400) return gameOver();
                bricks.forEach(b => {
                    if(b.v && ball.x>b.x && ball.x<b.x+45 && ball.y>b.y && ball.y<b.y+15) {
                        b.v = false; ball.dy *= -1; score += 20; updateScore();
                    }
                });
                ctx.fillStyle = '#000'; ctx.fillRect(0,0,400,400);
                ctx.fillStyle = '#ef4444'; bricks.forEach(b => b.v && ctx.fillRect(b.x, b.y, 45, 15));
                ctx.fillStyle = '#3b82f6'; ctx.fillRect(paddle, 380, 80, 10);
                ctx.fillStyle = '#fff'; ctx.fillRect(ball.x, ball.y, 8, 8);
            }, 15);
        }

        // 6. FLAPPY
        function initFlappy() {
            let bird = 200, vel = 0, pipes = [{x:400, y:200}];
            gameLoop = setInterval(() => {
                if(gameInput[' '] || gameInput['ArrowUp']) vel = -5;
                vel += 0.3; bird += vel;
                pipes.forEach(p => {
                    p.x -= 3;
                    if(p.x < -50) { p.x = 400; p.y = 100 + Math.random()*200; score++; updateScore(); }
                    if(p.x < 50 && p.x > 0 && (bird < p.y - 50 || bird > p.y + 50)) return gameOver();
                });
                if(bird > 400 || bird < 0) return gameOver();
                ctx.fillStyle = '#000'; ctx.fillRect(0,0,400,400);
                ctx.fillStyle = '#fbbf24'; ctx.fillRect(30, bird, 20, 20);
                ctx.fillStyle = '#22c55e'; pipes.forEach(p => {
                    ctx.fillRect(p.x, 0, 40, p.y-50); ctx.fillRect(p.x, p.y+50, 40, 400);
                });
            }, 20);
        }

        // 7. SPACER
        function initSpacer() {
            let ship = 200, bullets = [], enemies = [];
            gameLoop = setInterval(() => {
                if(gameInput['ArrowLeft']) ship -= 5; if(gameInput['ArrowRight']) ship += 5;
                if(gameInput[' ']) bullets.push({x:ship+8, y:370});
                if(Math.random() < 0.05) enemies.push({x:Math.random()*380, y:0});
                bullets.forEach((b, i) => { b.y -= 7; if(b.y<0) bullets.splice(i,1); });
                enemies.forEach((e, i) => { 
                    e.y += 3; 
                    if(e.y>400) return gameOver();
                    bullets.forEach((b, bi) => {
                        if(Math.hypot(e.x-b.x, e.y-b.y) < 20) { enemies.splice(i,1); bullets.splice(bi,1); score += 50; updateScore(); }
                    });
                });
                ctx.fillStyle = '#000'; ctx.fillRect(0,0,400,400);
                ctx.fillStyle = '#fff'; bullets.forEach(b => ctx.fillRect(b.x, b.y, 4, 10));
                ctx.fillStyle = '#3b82f6'; ctx.fillRect(ship, 380, 20, 10);
                ctx.fillStyle = '#ef4444'; enemies.forEach(e => ctx.fillRect(e.x, e.y, 20, 20));
            }, 20);
        }

        // 8. RUNNER (Dino clone)
        function initRunner() {
            let y = 350, vel = 0, obs = [{x:400}];
            gameLoop = setInterval(() => {
                if((gameInput[' '] || gameInput['ArrowUp']) && y >= 350) vel = -10;
                vel += 0.5; y += vel; if(y > 350) y = 350;
                obs.forEach(o => {
                    o.x -= 5;
                    if(o.x < -20) { o.x = 400 + Math.random()*200; score++; updateScore(); }
                    if(o.x < 50 && o.x > 20 && y > 320) return gameOver();
                });
                ctx.fillStyle = '#000'; ctx.fillRect(0,0,400,400);
                ctx.fillStyle = '#fff'; ctx.fillRect(20, y, 30, 30);
                ctx.fillStyle = '#ef4444'; obs.forEach(o => ctx.fillRect(o.x, 350, 20, 30));
            }, 20);
        }

        // 9. MAZE
        function initMaze() {
            let px = 20, py = 20;
            let walls = [];
            for(let i=0; i<30; i++) walls.push({x:Math.floor(Math.random()*19)*20, y:Math.floor(Math.random()*19)*20});
            let goal = {x:360, y:360};
            gameLoop = setInterval(() => {
                let ox = px, oy = py;
                if(gameInput['ArrowUp']) py -= 4; if(gameInput['ArrowDown']) py += 4;
                if(gameInput['ArrowLeft']) px -= 4; if(gameInput['ArrowRight']) px += 4;
                if(walls.some(w => px < w.x+20 && px+15 > w.x && py < w.y+20 && py+15 > w.y)) { px = ox; py = oy; }
                if(Math.hypot(px-goal.x, py-goal.y) < 20) { score += 1000; updateScore(); initMaze(); }
                ctx.fillStyle = '#000'; ctx.fillRect(0,0,400,400);
                ctx.fillStyle = '#334155'; walls.forEach(w => ctx.fillRect(w.x, w.y, 20, 20));
                ctx.fillStyle = '#22c55e'; ctx.fillRect(goal.x, goal.y, 20, 20);
                ctx.fillStyle = '#fff'; ctx.fillRect(px, py, 15, 15);
            }, 20);
        }

    </script>
</body>
</html>
